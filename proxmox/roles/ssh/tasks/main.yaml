---
- name: Remove SSH host keys
  become: true
  become_user: root
  block:

    - name: Delete all SSH host key files
      ansible.builtin.file:
        path: "/etc/ssh/{{ item }}"
        state: absent
      with_fileglob:
        - "/etc/ssh/ssh_host_*"

    - name: Ensure PubkeyAuthentication is enabled
      ansible.builtin.lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^#?PubkeyAuthentication'
        line: 'PubkeyAuthentication yes'
        state: present
      notify: Restart SSH
